@if (operationError()) {
  <div class="text-center mb-4">
    <p class="text-red-500">{{operationError()}}</p>
  </div>
}

<div class="posts-container">
  
  @if(!showForm())
 { 
  <div class="flex max-w-3xs mx-auto px-4 mb-8 justify-center bg-blue-100 hover:bg-blue-500 rounded transition-colors">
    <button class="p-1" aria-label="Add" (click)="onAdd()">
      <lucide-angular [img]="addIcon" class="w-5 h-5"></lucide-angular>
    </button>
  </div>
  
  @if (isLoading()) {
    <div class="text-center mb-8">
      <p>Loading posts...</p>
    </div>
  } @else if (error()) {
    <div class="text-center mb-8">
      <p class="text-red-500">{{error()}}</p>
      <button (click)="loadPosts()" class="px-4 py-2 bg-blue-500 text-white rounded">Retry</button>
    </div>
  } @else {
    @for (post of posts(); track post.id) {
      <div (click)="onViewPost(post)" class="cursor-pointer hover:opacity-90 transition-opacity">
        <app-post
          [post]="post"
          (edit)="onEdit($event)"
          (delete)="onDelete($event)"
          (comments)="onComments($event)">
        </app-post>
      </div>
    }
  }
}
</div>

@if (showForm()) {
  <div class="max-w-xl mx-auto px-4 mb-8">
    <mat-card class="w-full">
      <mat-card-header>
        <mat-card-title>{{ editingPost() ? 'Edit Post' : 'Add New Post' }}</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        @if (operationError()) {
          <p class="text-red-500 mb-4">{{operationError()}}</p>
        }
        <form [formGroup]="form" (ngSubmit)="onSubmit()">
          <div class="mb-4">
            <label class="block text-sm font-medium mb-2">Title</label>
            <input type="text" formControlName="title" class="w-full p-2 border rounded" [class.border-red-500]="form.get('title')?.invalid && form.get('title')?.touched">
            @if (form.get('title')?.invalid && form.get('title')?.touched) {
              <p class="text-red-500 text-sm mt-1">Title is required</p>
            }
          </div>
          <div class="mb-4">
            <label class="block text-sm font-medium mb-2">Body</label>
            <textarea formControlName="body" class="w-full p-2 border rounded" rows="4" [class.border-red-500]="form.get('body')?.invalid && form.get('body')?.touched"></textarea>
            @if (form.get('body')?.invalid && form.get('body')?.touched) {
              <p class="text-red-500 text-sm mt-1">Body is required</p>
            }
          </div>
          <div class="flex gap-2">
            <button type="submit" [disabled]="isSubmitting() || form.invalid" class="px-4 py-2 bg-blue-500 hover:bg-blue-400 text-white rounded disabled:opacity-50">
              {{ isSubmitting() ? 'Saving...' : 'Save' }}
            </button>
            <button type="button" (click)="cancelForm()" class="px-4 py-2 bg-red-500 hover:bg-red-400 text-white rounded">Cancel</button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>
  </div>
}

